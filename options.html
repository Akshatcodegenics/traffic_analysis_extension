<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Analyzer Pro - Settings</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .options-container {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--spacing-2xl);
        }
        
        .options-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }
        
        .options-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--spacing-md);
        }
        
        .options-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--spacing-xl);
        }
        
        .option-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
        }
        
        .section-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .section-icon {
            width: 24px;
            height: 24px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-sm);
        }
        
        .option-item {
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .option-item:last-child {
            border-bottom: none;
        }
        
        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-sm);
        }
        
        .option-info h4 {
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }
        
        .option-description {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .advanced-options {
            margin-top: var(--spacing-xl);
        }
        
        .advanced-toggle {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all var(--transition-base);
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .advanced-toggle:hover {
            background: var(--bg-hover);
            border-color: var(--primary-color);
        }
        
        .advanced-content {
            display: none;
            margin-top: var(--spacing-lg);
            padding: var(--spacing-lg);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        
        .advanced-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }
        
        .input-group {
            margin-bottom: var(--spacing-md);
        }
        
        .input-label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .text-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            transition: all var(--transition-base);
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .select-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            cursor: pointer;
        }
        
        .options-footer {
            text-align: center;
            margin-top: var(--spacing-2xl);
            padding-top: var(--spacing-xl);
            border-top: 1px solid var(--border-color);
        }
        
        .save-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .reset-button {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
            margin-left: var(--spacing-md);
        }
        
        .reset-button:hover {
            background: var(--bg-hover);
            border-color: var(--error-color);
            color: var(--error-color);
        }
    </style>
</head>
<body>
    <div class="options-container">
        <!-- Header -->
        <div class="options-header">
            <h1 class="options-title">Traffic Analyzer Pro</h1>
            <p class="options-subtitle">Configure your traffic analysis experience</p>
        </div>

        <!-- Options Grid -->
        <div class="options-grid">
            <!-- General Settings -->
            <div class="option-section">
                <h2 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    General Settings
                </h2>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Theme Preference</h4>
                            <p class="option-description">Choose your preferred color scheme</p>
                        </div>
                        <select class="select-input" id="themeSelect" style="width: 120px;">
                            <option value="auto">Auto</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Auto-refresh Data</h4>
                            <p class="option-description">Automatically update traffic data every minute</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="autoRefreshOption" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Default View</h4>
                            <p class="option-description">Choose which view to show when opening the extension</p>
                        </div>
                        <select class="select-input" id="defaultViewSelect" style="width: 140px;">
                            <option value="dashboard">Dashboard</option>
                            <option value="heatmap">Heatmap</option>
                            <option value="routes">Routes</option>
                            <option value="analytics">Analytics</option>
                        </select>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Units</h4>
                            <p class="option-description">Distance and speed measurement units</p>
                        </div>
                        <select class="select-input" id="unitsSelect" style="width: 120px;">
                            <option value="imperial">Imperial</option>
                            <option value="metric">Metric</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div class="option-section">
                <h2 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    Notifications
                </h2>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Enable Notifications</h4>
                            <p class="option-description">Receive traffic alerts and route updates</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="notificationsOption" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Traffic Incidents</h4>
                            <p class="option-description">Get notified about accidents and construction</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="incidentNotifications" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Route Alerts</h4>
                            <p class="option-description">Alerts for unusual delays on pinned routes</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="routeAlerts" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Voice Alerts</h4>
                            <p class="option-description">Enable spoken notifications for critical alerts</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="voiceAlertsOption">
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data & Privacy -->
            <div class="option-section">
                <h2 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    Data & Privacy
                </h2>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Usage Analytics</h4>
                            <p class="option-description">Share anonymous usage data to improve the extension</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="analyticsOption" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Location Services</h4>
                            <p class="option-description">Use your location for personalized traffic insights</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="locationServices" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Data Retention</h4>
                            <p class="option-description">How long to keep historical traffic data</p>
                        </div>
                        <select class="select-input" id="dataRetention" style="width: 120px;">
                            <option value="1week">1 Week</option>
                            <option value="1month" selected>1 Month</option>
                            <option value="3months">3 Months</option>
                            <option value="never">Never Delete</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Map Integration -->
            <div class="option-section">
                <h2 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-map"></i>
                    </div>
                    Map Integration
                </h2>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Google Maps Integration</h4>
                            <p class="option-description">Show traffic insights on Google Maps</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="googleMapsIntegration" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Waze Integration</h4>
                            <p class="option-description">Display notifications on Waze</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="wazeIntegration" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Widget Position</h4>
                            <p class="option-description">Where to show the floating widget</p>
                        </div>
                        <select class="select-input" id="widgetPosition" style="width: 140px;">
                            <option value="top-right" selected>Top Right</option>
                            <option value="top-left">Top Left</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-left">Bottom Left</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Performance -->
            <div class="option-section">
                <h2 class="section-title">
                    <div class="section-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    Performance
                </h2>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Update Frequency</h4>
                            <p class="option-description">How often to refresh traffic data</p>
                        </div>
                        <select class="select-input" id="updateFrequency" style="width: 120px;">
                            <option value="30">30 seconds</option>
                            <option value="60" selected>1 minute</option>
                            <option value="300">5 minutes</option>
                            <option value="600">10 minutes</option>
                        </select>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Animation Effects</h4>
                            <p class="option-description">Enable smooth animations and transitions</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="animationEffects" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-header">
                        <div class="option-info">
                            <h4>Background Updates</h4>
                            <p class="option-description">Continue updating data when extension is closed</p>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="backgroundUpdates" checked>
                            <span class="slider"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Options -->
        <div class="advanced-options">
            <button class="advanced-toggle" id="advancedToggle">
                <span>Advanced Options</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            
            <div class="advanced-content" id="advancedContent">
                <div class="options-grid">
                    <div class="option-section">
                        <h3 class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            API Configuration
                        </h3>

                        <div class="input-group">
                            <label class="input-label" for="apiEndpoint">Custom API Endpoint</label>
                            <input type="url" class="text-input" id="apiEndpoint" placeholder="https://api.example.com/traffic">
                        </div>

                        <div class="input-group">
                            <label class="input-label" for="apiKey">API Key</label>
                            <input type="password" class="text-input" id="apiKey" placeholder="Enter your API key">
                        </div>

                        <div class="input-group">
                            <label class="input-label" for="requestTimeout">Request Timeout (seconds)</label>
                            <input type="number" class="text-input" id="requestTimeout" value="10" min="5" max="60">
                        </div>
                    </div>

                    <div class="option-section">
                        <h3 class="section-title">
                            <div class="section-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            Data Management
                        </h3>

                        <div class="option-item">
                            <div class="option-header">
                                <div class="option-info">
                                    <h4>Cache Size Limit</h4>
                                    <p class="option-description">Maximum storage for cached data</p>
                                </div>
                                <select class="select-input" id="cacheLimit" style="width: 100px;">
                                    <option value="10">10 MB</option>
                                    <option value="50" selected>50 MB</option>
                                    <option value="100">100 MB</option>
                                    <option value="500">500 MB</option>
                                </select>
                            </div>
                        </div>

                        <div class="option-item">
                            <button class="action-btn secondary" id="clearCacheBtn">
                                <i class="fas fa-trash"></i>
                                Clear Cache
                            </button>
                        </div>

                        <div class="option-item">
                            <button class="action-btn secondary" id="exportDataBtn">
                                <i class="fas fa-download"></i>
                                Export Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="options-footer">
            <button class="save-button" id="saveSettings">
                <i class="fas fa-save"></i>
                Save Settings
            </button>
            <button class="reset-button" id="resetSettings">
                <i class="fas fa-undo"></i>
                Reset to Defaults
            </button>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="toast" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); opacity: 0;">
            <div class="toast-content">
                <i class="fas fa-check-circle"></i>
                <span>Settings saved successfully!</span>
            </div>
        </div>
    </div>

    <script>
        // ===== OPTIONS PAGE SCRIPT =====
        
        class OptionsManager {
            constructor() {
                this.settings = {};
                this.init();
            }

            async init() {
                await this.loadSettings();
                this.setupEventListeners();
                this.updateUI();
            }

            async loadSettings() {
                try {
                    this.settings = await chrome.storage.sync.get({
                        theme: 'auto',
                        autoRefresh: true,
                        defaultView: 'dashboard',
                        units: 'imperial',
                        notifications: true,
                        incidentNotifications: true,
                        routeAlerts: true,
                        voiceAlerts: false,
                        analytics: true,
                        locationServices: true,
                        dataRetention: '1month',
                        googleMapsIntegration: true,
                        wazeIntegration: true,
                        widgetPosition: 'top-right',
                        updateFrequency: '60',
                        animationEffects: true,
                        backgroundUpdates: true,
                        apiEndpoint: '',
                        apiKey: '',
                        requestTimeout: 10,
                        cacheLimit: '50'
                    });
                } catch (error) {
                    console.error('Failed to load settings:', error);
                }
            }

            updateUI() {
                // Update all form elements with current settings
                Object.keys(this.settings).forEach(key => {
                    const element = document.getElementById(key + 'Option') || document.getElementById(key + 'Select') || document.getElementById(key);
                    
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = this.settings[key];
                        } else {
                            element.value = this.settings[key];
                        }
                    }
                });

                // Apply current theme
                document.documentElement.setAttribute('data-theme', this.settings.theme === 'auto' ? 'light' : this.settings.theme);
            }

            setupEventListeners() {
                // Theme selector
                document.getElementById('themeSelect').addEventListener('change', (e) => {
                    const theme = e.target.value;
                    document.documentElement.setAttribute('data-theme', theme === 'auto' ? 'light' : theme);
                });

                // Advanced options toggle
                document.getElementById('advancedToggle').addEventListener('click', () => {
                    const content = document.getElementById('advancedContent');
                    const icon = document.querySelector('#advancedToggle i');
                    
                    content.classList.toggle('show');
                    icon.style.transform = content.classList.contains('show') ? 'rotate(180deg)' : 'rotate(0deg)';
                });

                // Save settings
                document.getElementById('saveSettings').addEventListener('click', () => {
                    this.saveSettings();
                });

                // Reset settings
                document.getElementById('resetSettings').addEventListener('click', () => {
                    this.resetSettings();
                });

                // Clear cache
                document.getElementById('clearCacheBtn').addEventListener('click', () => {
                    this.clearCache();
                });

                // Export data
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.exportData();
                });

                // Real-time theme updates
                document.getElementById('themeSelect').addEventListener('change', (e) => {
                    const theme = e.target.value;
                    document.documentElement.setAttribute('data-theme', theme === 'auto' ? 
                        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme
                    );
                });
            }

            async saveSettings() {
                const formData = {};
                
                // Collect all form values
                const inputs = document.querySelectorAll('input, select');
                inputs.forEach(input => {
                    const key = input.id.replace('Option', '').replace('Select', '');
                    if (key && key !== 'advancedToggle') {
                        formData[key] = input.type === 'checkbox' ? input.checked : input.value;
                    }
                });

                try {
                    await chrome.storage.sync.set(formData);
                    this.settings = { ...this.settings, ...formData };
                    this.showStatusMessage('Settings saved successfully!', 'success');
                    
                    // Notify background script of settings change
                    chrome.runtime.sendMessage({
                        type: 'UPDATE_SETTINGS',
                        data: formData
                    });
                    
                } catch (error) {
                    console.error('Failed to save settings:', error);
                    this.showStatusMessage('Failed to save settings', 'error');
                }
            }

            async resetSettings() {
                if (!confirm('Are you sure you want to reset all settings to defaults? This action cannot be undone.')) {
                    return;
                }

                try {
                    await chrome.storage.sync.clear();
                    await this.loadSettings();
                    this.updateUI();
                    this.showStatusMessage('Settings reset to defaults', 'info');
                } catch (error) {
                    console.error('Failed to reset settings:', error);
                    this.showStatusMessage('Failed to reset settings', 'error');
                }
            }

            async clearCache() {
                try {
                    await chrome.storage.local.clear();
                    this.showStatusMessage('Cache cleared successfully', 'success');
                } catch (error) {
                    console.error('Failed to clear cache:', error);
                    this.showStatusMessage('Failed to clear cache', 'error');
                }
            }

            async exportData() {
                try {
                    const data = await chrome.storage.local.get();
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `traffic-analyzer-data-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showStatusMessage('Data exported successfully', 'success');
                } catch (error) {
                    console.error('Failed to export data:', error);
                    this.showStatusMessage('Failed to export data', 'error');
                }
            }

            showStatusMessage(message, type = 'success') {
                const statusEl = document.getElementById('statusMessage');
                const icon = statusEl.querySelector('i');
                const text = statusEl.querySelector('span');
                
                // Update content
                text.textContent = message;
                
                // Update icon based on type
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    info: 'fa-info-circle'
                };
                icon.className = `fas ${icons[type] || icons.success}`;
                
                // Update styling
                statusEl.className = `toast toast-${type}`;
                
                // Show and hide
                statusEl.style.opacity = '1';
                setTimeout(() => {
                    statusEl.style.opacity = '0';
                }, 3000);
            }
        }

        // Initialize options manager
        document.addEventListener('DOMContentLoaded', () => {
            new OptionsManager();
        });
    </script>
</body>
</html>
